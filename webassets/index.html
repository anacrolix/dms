<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light dark">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
  <script src="https://cdn.jsdelivr.net/npm/@alpinejs/collapse@3.x.x/dist/cdn.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <script src="./webadmin.js"></script>

  <title>Dms web interface</title>
  <style>
    .buttonremoveaction {
      background-color: orange;
      border-color: orangered;
      color: midnightblue;
    }

    .contentblock {
      vertical-align: middle;
      background-color: Lavender;
      padding: 0.5em;
      border-radius: 0.5em;
    }
  </style>

</head>

<body style="background-color: rgb(240, 248, 255);">
  <main class="container">
    <h1>Dms web interface</h1>
    <small>A basic interface for dms administration</small><br>
    <p>This minimal interface provides function for blocking and unblocking clients. The changes are not saved to the
      configuration.</p>

    <h2>Blacklist</h2>
    <p>Blacklist has priority over whitelist</p>

    <div x-data="updateData()" id="blacklistcontainer">
      <div x-show="loading">Loading...</div>

      <div x-show="!loading" class="contentblock">
        <div class="grid">
          <div><strong>Ip address</strong></div>
          <div><strong>Mask</strong></div>
          <div><strong>Action</strong></div>
        </div>
        <hr>

        <template x-for="item in items['blacklist']">
          <article>
            <div class="grid">
              <div x-text="item.IP"></div>
              <div><code x-text="item.Mask"></code></div>
              <div><button x-on:click="remove_blacklist(item.IP)" class="buttonremoveaction">Remove item</button></div>
            </div>
          </article>
        </template>

        <div x-data="{ expanded: false }">
          <button @click="expanded = ! expanded">Add to blacklist</button>

          <div x-show="expanded" x-collapse style="padding: 0.5em;">
            <article x-data="genericFormHandler('/blacklist/')">
              <form @submit.prevent="submitForm">
                <div class="grid">
                  <div>Ip address</div>
                  <div><input name="ip_addr" placeholder="Ip address, like 192.168.0.1" x-model="ip_addr"/></div>
                  <div><input type="submit" value="Submit"></div>
                </div>
              </form>
            </article>
          </div>
        </div>

      </div>
    </div><!-- /blacklistcontainer -->

    <h2>Whitelist</h2>
    <div x-data="updateData()" id="whitelistcontainer">
      <div x-show="loading">Loading...</div>

      <div x-show="!loading" class="contentblock">
        <div class="grid">
          <div><strong>Ip address</strong></div>
          <div><strong>Mask</strong></div>
          <div><strong>Action</strong></div>
        </div>
        <hr>

        <template x-for="item in items['whitelist']">
          <article>
            <div class="grid">
              <div x-text="item.IP"></div>
              <div><code x-text="item.Mask"></code></div>
              <div><button x-on:click="remove_whitelist(item.IP)" class="buttonremoveaction">Remove item</button></div>
            </div>
          </article>
        </template>
        <div x-data="{ expanded: false }">
          <button @click="expanded = ! expanded">Add to whitelist</button>

          <div x-show="expanded" x-collapse style="padding: 0.5em;">
            <article x-data="genericFormHandler('/whitelist/')">
              <form @submit.prevent="submitForm">
                <div class="grid">
                  <div>Ip address</div>
                  <div><input name="ip_addr" placeholder="Ip address, like 192.168.0.1" x-model="ip_addr"/></div>
                  <div><input type="submit" value="Submit"></div>
                </div>
              </form>
            </article>
          </div>
        </div>

      </div>
    </div><!-- /whitelistcontainer -->

    <h2>Connected clients</h2>
    <div x-data="updateData()">
      <div x-show="loading">Loading...</div>

      <div x-show="!loading" class="contentblock">
        <div class="grid">
          <div><strong>Ip address</strong></div>
          <div style=><strong>Action</strong></div>
          <div><strong>Last browsed file</strong></div>
        </div>
        <hr>

        <template x-for="(value, index) in items['allowed']">
          <article>
            <div class="grid">
              <div x-text="index"></div>
              <div><button x-on:click="block(index)" class="buttonremoveaction">Block</button></div>
              <div><code x-text="value"></code></div>
            </div>
          </article>
        </template>
      </div>
    </div>

    <h2>Refused clients</h2>
    <div x-data="updateData()">
      <div x-show="loading">Loading...</div>

      <div x-show="!loading" class="contentblock">
        <article>
          <template x-for="(value, index) in items['refused']">
            <div><button x-on:click="unblock(index)" x-text="index"></button></div>
          </template>
        </article>
      </div>
    </div>
  </main>
</body>

</html>